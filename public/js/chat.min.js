const socket=io(),incommingmessage=new Audio("./../sounds/incommingmessage.wav"),outgoingmessage=new Audio("./../sounds/outgoingmessage.wav"),joinsound=new Audio("./../sounds/join.wav"),leavesound=new Audio("./../sounds/leave.wav"),typingsound=new Audio("./../sounds/typing.wav");let myname,myid,scrolling=!1,lastPageLength=$("#messages").scrollTop(),scroll=0;const userMap=new Map,reactList=new Map,maxTypeShow=2;let typing=!1,timeout=void 0,isReply=!1,replyTo,replyText,targetId;const emoji_regex=/^(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|[\ud83c[\ude32-\ude3a]|[\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])+$/;class ClickAndHold{constructor(target,timeOut,callback){this.target=target,this.callback=callback,this.isHeld=!1,this.activeHoldTimeoutId=null,this.timeOut=timeOut,["touchstart","mousedown"].forEach(eventName=>{try{this.target.addEventListener(eventName,this._onHoldStart.bind(this))}catch(e){console.log(e)}}),["touchmove","mousemove"].forEach(eventName=>{try{this.target.addEventListener(eventName,this._onHoldMove.bind(this))}catch(e){console.log(e)}}),["mouseup","touchend","mouseleave","mouseout","touchcancel"].forEach(eventName=>{try{this.target.addEventListener(eventName,this._onHoldEnd.bind(this))}catch(e){console.log(e)}})}_onHoldStart(evt){this.isHeld=!0,this.activeHoldTimeoutId=setTimeout(()=>{this.isHeld&&this.callback(evt)},this.timeOut)}_onHoldMove(){this.isHeld=!1}_onHoldEnd(){this.isHeld=!1,clearTimeout(this.activeHoldTimeoutId)}static applyTo(target,timeOut,callback){try{new ClickAndHold(target,timeOut,callback)}catch(e){console.log(e)}}}const myMessageTemplate=$("#my-message-template").html(),messageTemplate=$("#message-template").html(),serverMessageTemplate=$("#server-message-template").html(),locationMessageTemplate=$("#location-message-template").html(),imageMessageTemplate=$("#image-message-template").html(),myImageMessageTemplate=$("#my-image-message-template").html();function addReact(target,userName,react){let user=userName==myname?"You":userName,emoji,count;switch(react){case"senti":emoji="üëçüèª";break;case"haha":emoji="üòÇ";break;case"sad":emoji="üò¢";break;case"wow":emoji="üòÆ";break;case"love":emoji="‚ù§Ô∏è";break;case"angry":emoji="üò†"}if($(`#${target} .reactor ul`).find(`li:contains(${user})`)){if($(`#${target} .reactor ul .react-or-${user} .emoticon`).text()==emoji)return void socket.emit("removeReact",userName,target);$(`#${target} .reactor ul`).find(`li:contains(${user})`).remove(),$(`#${target} .reactor ul`).append(`<li class='react-or-${user}'><span>${user}</span><span class='emoticon' data-name='${react}'>${emoji}</span></li>`)}loadReact(target),$(`#${target} .reactions`).children().length>=3&&$(`#${target} .reactions`).children().first().remove();let prev=user;$(`#${target} .reactions li`).each((index,elem)=>{let now;elem.classList[1]==prev&&$(elem).remove()}),$(`#${target} .reactions`).append(`<li class='emo ${user}'>${emoji}</li>`),$(`#${target} .object`).css("margin-bottom","10px"),updateScroll()}function removeReaction(u_name,id){$(`#${id} .reactions .${u_name==myname?"You":u_name}`).remove(),$(`#${id} .react-or-${u_name==myname?"You":u_name}`).remove(),0==$(`#${id} .reactions`).children().length&&$(`#${id} .object`).css("margin-bottom","")}function appHeight(){const doc=document.documentElement;doc.style.setProperty("--app-height",`${window.innerHeight}px`)}function updateScroll(avatar=null,text=""){if(scrolling)return void(text.length>0&&($(".newmessagepopup img").attr("src",`./../images/avatars/${avatar}(custom).png`),$(".newmessagepopup .msg").text(text.length>20?`${text.substring(0,20)} ...`:text),$(".newmessagepopup").fadeIn(200)));let element=document.getElementById("messages");element.scrollTop=element.scrollHeight,lastPageLength=$("#messages").scrollTop(),removeNewMessagePopup()}function removeNewMessagePopup(){$(".newmessagepopup").fadeOut(200)}function censorBadWords(text){return text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=(text=text.replace(/fuck/g,"f**k")).replace(/shit/g,"s**t")).replace(/bitch/g,"b**t")).replace(/asshole/g,"a**hole")).replace(/dick/g,"d**k")).replace(/pussy/g,"p**s")).replace(/cock/g,"c**k")).replace(/baal/g,"b**l")).replace(/sex/g,"s*x")).replace(/Fuck/g,"F**k")).replace(/Shit/g,"S**t")).replace(/Bitch/g,"B**t")).replace(/Asshole/g,"A**hole")).replace(/Dick/g,"D**k")).replace(/Pussy/g,"P**s")).replace(/Cock/g,"C**k")).replace(/Baal/g,"B**l")).replace(/Sex/g,"S*x")}function makeid(length){let result="",characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",charactersLength=characters.length;for(let i=0;i<length;i++)result+=characters.charAt(Math.floor(Math.random()*charactersLength));return result}function saveImage(){try{let a=document.createElement("a");a.href=$(".lightbox__image img").attr("src"),a.download=`save-${moment().valueOf()}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(e){console.log(e)}}function resizeImage(img,mimetype){let canvas=document.createElement("canvas"),width=img.width,height=img.height,max_height=480,max_width=480,ctx;return width>height?width>480&&(height=Math.round(height*=480/width),width=480):height>480&&(width=Math.round(width*=480/height),height=480),canvas.width=width,canvas.height=height,canvas.getContext("2d").drawImage(img,0,0,width,height),canvas.toDataURL(mimetype,.7)}function linkify(inputText){let replacedText,replacePattern1,replacePattern2,replacePattern3;return replacePattern1=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,replacedText=inputText.replace(replacePattern1,'<a href="$1" target="_blank">$1</a>'),replacePattern2=/(^|[^\/])(www\.[\S]+(\b|$))/gim,replacedText=replacedText.replace(replacePattern2,'$1<a href="http://$2" target="_blank">$2</a>'),replacePattern3=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,replacedText=replacedText.replace(replacePattern3,'<a href="mailto:$1">$1</a>'),replacedText}function emo_test(str){return emoji_regex.test(str)}function copyText(text){navigator.clipboard.writeText(text),popupMessage("Copied to clipboard")}function popupMessage(text){$(".popup-message").text(text),$(".popup-message").fadeIn(500),setTimeout((function(){$(".popup-message").fadeOut(500)}),1e3)}function openImageView(evt){try{let target=evt.target;$(".lightbox__image").html(""),$(".lightbox__image").append(`<img src="${target.src}" alt="">`),$(".lightbox").fadeIn(100)}catch(e){console.log(e)}}function imageReply(evt){try{let target=evt.target;targetId=target.closest("._message").id,replyText="Image",replyTo=$(target).closest("._body").find(".title").text(),replyTo=replyTo.replace(/ replied to [a-zA-Z]+/g,"");let replyToPop=replyTo;replyToPop==myname&&(replyToPop="You"),"You"==replyTo&&(replyTo=myname),isReply=!0,$(".toast-popup").show(),$(".toast-popup-name").html(`<i class="fa-solid fa-reply"></i> Replying to ${replyToPop}`),$(".toast-popup-message").text("Image"),$("#textbox").focus()}catch(e){console.log(e)}}function textReply(evt){try{let target=evt.target;targetId=target.closest("._message").id,replyText=target.innerText.length>200?`${target.innerText.substring(0,200)} ...`:target.innerText,replyTo=$(target).closest("._body").find(".title").text(),replyTo=replyTo.replace(/ replied to [a-zA-Z]+/g,"");let replyToPop=replyTo;replyToPop==myname&&(replyToPop="You"),"You"==replyTo&&(replyTo=myname),isReply=!0,$(".toast-popup").show(),$(".toast-popup-name").html(`<i class="fa-solid fa-reply"></i> Replying to ${replyToPop}`),$(".toast-popup-message").text(target.innerText.length>50?`${target.innerText.substring(0,50)} ...`:target.innerText),$("#textbox").focus()}catch(e){console.log(e)}}function clickOptionHide(){repPop=!1,unbindClicks(),$(".click-option").hide(),$(".reactionContainer").hide(),$(".reactorContainer").hide(),$(".store-action").hide(),$(".copy-action").hide()}function unbindClicks(){$(".click-option").unbind("click"),$(".reactionContainer").unbind("click")}function deleteMessage(evt,type){try{"text"==type?(targetId=targetId=evt.target.closest("._message").id,socket.emit("delete message",targetId,myname)):"image"==type&&(targetId=evt.target.closest("._message").id,socket.emit("delete image",targetId,myname))}catch(e){console.log(e)}}function sendReaction(evt,reaction){try{targetId=evt.target.closest("._message").id,socket.emit("reaction",targetId,myname,reaction)}catch(e){console.log(e)}}function lightboxClose(){$(".lightbox").fadeOut(100,()=>{$(".lightbox__image").html("")})}function clickOptionShow(type,evt1){repPop=!0,unbindClicks(),$(".click-option").fadeIn(100),"text"===type?($(".store-action").hide(),$(".copy-action").show(),$(".delete-action").show(),$(".reactorContainer").hide(),$(".click-option").on("click",evt=>{evt.target.classList.contains("fa-reply")?(textReply(evt1),clickOptionHide()):evt.target.classList.contains("fa-clone")?(copyText(evt1.target.innerText),clickOptionHide()):evt.target.classList.contains("fa-trash")&&(deleteMessage(evt1,"text"),clickOptionHide())}),$(".reactionContainer").on("click",evt=>{evt.target.className.includes("senti")?sendReaction(evt1,"senti"):evt.target.className.includes("haha")?sendReaction(evt1,"haha"):evt.target.className.includes("sad")?sendReaction(evt1,"sad"):evt.target.className.includes("wow")?sendReaction(evt1,"wow"):evt.target.className.includes("love")?sendReaction(evt1,"love"):evt.target.className.includes("angry")&&sendReaction(evt1,"angry"),clickOptionHide()})):"image"===type&&($(".store-action").show(),$(".copy-action").hide(),$(".delete-action").show(),$(".reactorContainer").hide(),$(".click-option").on("click",evt=>{evt.target.classList.contains("fa-reply")?(imageReply(evt1),clickOptionHide()):evt.target.classList.contains("fa-download")?($(".lightbox__image").html(""),$(".lightbox__image").append(`<img src="${evt1.target.src}" alt="">`),saveImage(),clickOptionHide()):evt.target.classList.contains("fa-trash")&&(deleteMessage(evt1,"image"),clickOptionHide())}),$(".reactionContainer").on("click",evt=>{evt.target.className.includes("senti")?sendReaction(evt1,"senti"):evt.target.className.includes("haha")?sendReaction(evt1,"haha"):evt.target.className.includes("sad")?sendReaction(evt1,"sad"):evt.target.className.includes("wow")?sendReaction(evt1,"wow"):evt.target.className.includes("love")?sendReaction(evt1,"love"):evt.target.className.includes("angry")&&sendReaction(evt1,"angry"),clickOptionHide()}))}function closePopup(){isReply=!1,$(".toast-popup").hide(),$(".toast-popup-name").text(""),$(".toast-popup-message").text(""),$(".about").hide(),$(".menuwrapper").removeClass("active")}function reactOptionShow(evt){let target=evt.target.closest("._message").id,emoji=$(`#${target} .react-or-You .emoticon`).text(),reactionName=$(`#${target} .react-or-You .emoticon`).data("name");$(".reactionContainer > div").css("background",""),reactionName&&$(`.reactionContainer .${reactionName}`).css("background","#00000075"),$(".reactionContainer").fadeIn(100)}function loadReact(id,show=!1){$(".reactorContainer ul").html("");let elem=$(`#${id} .reactor ul`).html();$(".reactorContainer ul").append(elem),show&&(""!==elem?$(".reactorContainer").show():$(".reactorContainer").hide())}$("#my-message-template").remove(),$("#message-template").remove(),$("#server-message-template").remove(),$("#location-message-template").remove(),$("#image-message-template").remove(),$("#my-image-message-template").remove(),socket.on("connect",(function(){let name,key,avatar,maxuser,params={name:$("#myname").text(),key:$("#mykey").text(),avatar:$("#myavatar").text(),maxuser:$("#maxuser").text()};socket.emit("join",params,(function(err){err?(console.log(err),popupMessage(err)):(console.log("No error"),popupMessage("Connected to server"),$("#main-screen").css("visibility","visible"),$("#preloader").css("visibility","hidden"),$("#preloader").remove())}))})),socket.on("disconnect",(function(){console.log("Disconnected from server"),popupMessage("Disconnected from server")})),socket.on("updateUserList",(function(users,ids,key,avatars){let ol=$("<ul></ul>");for(let i=0;i<users.length;i++)ol.append($(`<li class='user' id='${ids[i]}'></li>`).html(`<img height='30px' width='30px' src='images/avatars/${avatars[i]}(custom).png'> ${users[i]}`));$(".menu").html(`<i class="fa-solid fa-user"></i> ${users.length}`),$(".keyname1").text(`${key}`),$(".keyname2").text(`${key}`),$(".users").html(ol)})),socket.on("newMessage",(function(message,avatar,isReply,replyTo,replyText,id,targetId){incommingmessage.play();let formattedTime=moment(message.createdAt).format("hh:mm a"),html;isReply?(replyTo==myname&&(replyTo="You"),html=Mustache.render(messageTemplate,{text:linkify(message.text),from:`${message.from} replied to ${replyTo}`,reply:replyText,id:id,repId:targetId,repIcon:'<i class="fa-solid fa-reply"></i>',createdAt:formattedTime,attr:"style",replyMessageStyle:"display: block; transform: translateY(20px);",messageTitleStyle:"transform: translateY(20px)",attrVal:`images/avatars/${avatar}(custom).png`})):html=Mustache.render(messageTemplate,{text:linkify(message.text),from:message.from,id:id,attr:"style",replyMessageStyle:"display: none; transform: translateY(0px);",messageTitleStyle:"transform: translateY(0px)",createdAt:formattedTime,attrVal:`images/avatars/${avatar}(custom).png`}),html=html.replace(/¬∂/g,"<br>"),$("#messages").append(html),emo_test(message.text)&&$("#messages li:last div p").css({background:"none","font-size":"30px",padding:"0px"}),updateScroll(avatar,message.text)})),socket.on("messageSent",(function(replaceId,id){outgoingmessage.play();try{$(`#${replaceId}`).attr("id",id),$(`#${id} .sent`).attr("class","fa-solid fa-circle-check sent")}catch(e){console.log(e)}})),socket.on("server_message",(function(message,name=null,id=null){myname=name||myname,myid=id||myid;let html=Mustache.render(serverMessageTemplate,{text:message.text,from:message.from});message.text.includes("joined")&&(html=html.replace(/<p>/g,"<p style='color: limegreen;'>"),joinsound.play()),message.text.includes("left")?(html=html.replace(/<p>/g,"<p style='color: orangered;'>"),leavesound.play()):html=html.replace(/<p>/g,"<p style='color: var(--blue);'>"),$("#messages").append(html),updateScroll()})),socket.on("newLocationMessage",(function(message){let html=Mustache.render(locationMessageTemplate,{from:message.from,url:message.url});incommingmessage.play(),$("#messages").append(html),updateScroll()})),socket.on("typing",(user,id)=>{typingsound.play(),userMap.set(id,user);let _typing="",mapkeys=userMap.values();for(let i=1;i<=userMap.size;i++)if(_typing+=`${mapkeys.next().value}, `,userMap.size>2){2==i&&(_typing=_typing.slice(0,-2),_typing+=` and ${userMap.size-2} others  `);break}_typing=_typing.slice(0,-2),$("#typingindicator").text(`${_typing} ${userMap.size>1?"are":"is"} typing...`)}),socket.on("stoptyping",id=>{if(userMap.delete(id),0==userMap.size)$("#typingindicator").text("");else{let _typing="",mapkeys=userMap.values();for(let i=1;i<=userMap.size;i++)if(_typing+=`${mapkeys.next().value}, `,userMap.size>2){2==i&&(_typing=_typing.slice(0,-2),_typing+=` and ${userMap.size-2} others  `);break}_typing=_typing.slice(0,-2),$("#typingindicator").text(`${_typing} ${userMap.size>1?"are":"is"} typing...`)}}),socket.on("vibrateResponse",(sender_name,id)=>{navigator.vibrate?id==myid&&(navigator.vibrate(1e3),popupMessage(`${sender_name==myname?"You":sender_name} just vibrated your Device`)):popupMessage("Device does not support web Vibration")}),socket.on("imageGet",(sendername,imagefile,avatar,id)=>{let html=Mustache.render(imageMessageTemplate,{from:sendername,id:id,attrVal:`images/avatars/${avatar}(custom).png`,image:`<img class='image-message' src='${imagefile}'>`,createdAt:moment().format("hh:mm a")});incommingmessage.play(),$("#messages").append(html),$(`#${id}`).find(".image-message").on("load",(function(){updateScroll(avatar,"Photo")}))}),socket.on("deleteMessage",(messageId,user)=>{try{$(`#${messageId} .object`).css("background","#dd0000"),setTimeout(()=>{$(`#${messageId}`).remove(),$(`[data-repid='${messageId}']`).text(`${user===myname?"You":user} deleted this message`),$(`[data-repid='${messageId}']`).css("background","#000000b5"),popupMessage(user==myname?"You deleted a message":`${user} deleted a message`),updateScroll()},1e3)}catch(e){console.log(e)}}),socket.on("deleteImage",(messageId,user)=>{try{$(`#${messageId} .object`).css("outline","1px solid orangered"),setTimeout(()=>{$(`#${messageId}`).remove(),$(`[data-repid='${messageId}']`).text(`${user} deleted this message`),$(`[data-repid='${messageId}']`).css("background","#000000b5"),popupMessage(user==myname?"You deleted an image":`${user} deleted an image`),updateScroll()},1e3)}catch(e){console.log(e)}}),socket.on("reactionResponse",(target,userName,react)=>{addReact(target,userName,react)}),socket.on("removeReactResponse",(u_name,id)=>{removeReaction(u_name,id)}),navigator.onLine?(console.log("online"),$(".offline").fadeOut(400)):(console.log("offline"),$(".offline").text("You are offline!"),$(".offline").css("background","orangered"),$(".offline").fadeIn(400)),window.addEventListener("offline",(function(e){console.log("offline"),$(".offline").text("You are offline!"),$(".offline").css("background","orangered"),$(".offline").fadeIn(400)})),window.addEventListener("online",(function(e){console.log("Back to online"),$(".offline").text("Back to online!"),$(".offline").css("background","limegreen"),setTimeout(()=>{$(".offline").fadeOut(400)},1500)})),$("#textbox").on("keydown",evt=>{evt.ctrlKey&&"Enter"===evt.key&&$(".send").click()}),$(".toast-popup-close").on("click",()=>{closePopup()}),$(".close-action").on("click",(function(evt){clickOptionHide()})),$("#messages").scroll((function(event){scroll=$("#messages").scrollTop(),scroll>=lastPageLength?(lastPageLength=scroll,removeNewMessagePopup(),scrolling=!1):scrolling=!0})),$(".newmessagepopup").click((function(){scrolling=!1,updateScroll(),removeNewMessagePopup()})),$("#message-form").on("submit",(function(e){e.preventDefault();let messageTextbox=$("[name=message]"),text=messageTextbox.val();if(messageTextbox.val(""),text.length>1e4&&(text=text.substring(0,1e4)),0==text.replace(/\n/g,"").replace(/ /g,"").length)return void $("#textbox").css("height","auto");text=text.trim(),text=censorBadWords(text),text=text.replace(/\n/g,"¬∂");let replaceId=makeid(10),formattedTime=moment().format("hh:mm a"),html;html=isReply?Mustache.render(myMessageTemplate,{text:linkify(text),from:`You replied to ${replyTo==myname?"You":replyTo}`,id:replaceId,repId:targetId,reply:replyText,repIcon:'<i class="fa-solid fa-reply"></i>',createdAt:formattedTime,attr:"style",replyMessageStyle:"display: block; transform: translateY(20px);",messageTitleStyle:"display: block; transform: translateY(20px)"}):Mustache.render(myMessageTemplate,{text:linkify(text),id:replaceId,from:myname,attr:"style",replyMessageStyle:"display: none; transform: translateY(0px);",messageTitleStyle:"display: none; transform: translateY(0px)",createdAt:formattedTime}),html=html.replace(/¬∂/g,"<br>"),$("#messages").append(html),emo_test(text)&&$("#messages li:last div p").css({background:"none","font-size":"30px",padding:"0px"}),typing=!1,socket.emit("stoptyping"),socket.emit("createMessage",{text:text},replaceId,isReply,replyTo,replyText,targetId,(function(){$("#textbox").css("height","auto")})),$("#textbox").css("height","auto"),scrolling=!1,closePopup(),clickOptionHide(),updateScroll()})),$("#send-location").on("click",(function(){navigator.geolocation?($("#send-location").attr("disabled","disabled").html('<i class="fa-solid fa-location-crosshairs"></i>'),navigator.geolocation.getCurrentPosition((function(position){$("#send-location").removeAttr("disabled").html('<i class="fa-solid fa-location-crosshairs"></i>'),socket.emit("createLocationMessage",{latitude:position.coords.latitude,longitude:position.coords.longitude})}),(function(){$("#send-location").removeAttr("disabled").html('<i class="fa-solid fa-location-crosshairs"></i>'),popupMessage("Unable to fetch location.")}))):popupMessage("Geolocation not supported by your browser.")})),$("#textbox").on("keydown",(function(){timeout&&(clearTimeout(timeout),timeout=void 0),typing||(typing=!0,socket.emit("typing")),timeout=setTimeout((function(){typing=!1,socket.emit("stoptyping")}),1e3)})),$(".menu").on("click",(function(){$(".menuwrapper").addClass("active")})),$("#textbox").on("focus",(function(){updateScroll()})),$(".info").on("click",()=>{$(".about").fadeIn(200)}),$(".close").on("click",()=>{$(".about").fadeOut(200)}),$(".key").on("click",()=>{let text;copyText($(".keyname1").text())}),$(".users").on("click",(function(evt){evt.preventDefault();let target=evt.target;if("user"===target.className){let targetId=target.id;socket.emit("vibrate",myname,targetId),targetId!==myid&&($(".popup-message").text(`You just vibrated ${target.innerText}'s Device`),$(".popup-message").fadeIn(500),setTimeout((function(){$(".popup-message").fadeOut(500)}),1e3))}})),$(".chat").on("click",(function(evt){$(".menuwrapper").removeClass("active"),$(".about").fadeOut(200)})),window.addEventListener("resize",()=>{updateScroll()}),$(".send").on("focus",(function(){$("#textbox").focus()})),$("textarea").each((function(){this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")})).on("input",(function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"})),$("#photo").on("change",()=>{let file=$("#photo")[0].files[0],reader=new FileReader;reader.readAsDataURL(file),reader.onload=function(e){$(".previewimage__image").html("<img src='"+e.target.result+"' alt='image'/>")},$(".previewimage").show()}),$(".previewimage__close").on("click",()=>{$(".previewimage").hide(100)}),$(".sendimage").on("click",()=>{let file=$("#photo")[0].files[0],reader=new FileReader;reader.readAsArrayBuffer(file),reader.onload=function(e){let blob=new Blob([e.target.result]);window.URL=window.URL||window.webkitURL;let blobURL=window.URL.createObjectURL(blob),image=new Image;image.src=blobURL,image.onload=function(){let resized=resizeImage(image,file.mimetype),tempId=makeid(10),html=Mustache.render(myImageMessageTemplate,{from:myname,id:tempId,image:`<img class='image-message' src='${resized}'>`,createdAt:moment(moment().valueOf()).format("hh:mm a")});$("#messages").append(html).ready(()=>{scrolling=!1,updateScroll()}),socket.emit("image",myname,tempId,resized)},$(".previewimage").hide(),$(".previewimage__image").html(""),clickOptionHide()}}),$(".lightbox__close").on("click",()=>{lightboxClose()}),$(".lightbox__save").on("click",()=>{saveImage()});const Messages=document.querySelector("#messages");let repPop=!1;Messages.addEventListener("click",e=>{if(e.target.className.includes("image-message"))repPop||openImageView(e);else if(e.target.className.includes("emo"))id=e.target.closest("._message").id,clickOptionHide(),loadReact(id,!0);else if(e.target.className.includes("replyMessage")){const msgId=e.target.dataset.repid,element=document.getElementById(msgId);try{element.scrollIntoView({block:"center"}),$("#messages .my__message").css("filter","brightness(0.5)"),$("#messages .message").css("filter","brightness(0.5)"),$(`#${msgId}`).css("filter","initial"),setTimeout((function(){$("#messages .my__message").css("filter",""),$("#messages .message").css("filter",""),$(`#${msgId}`).css("filter","")}),1e3)}catch(err){popupMessage("Deleted message")}}}),window.addEventListener("click",({target:target})=>{target.className.includes("_message")&&$(".reactorContainer").hide()}),ClickAndHold.applyTo(Messages,200,(function(evt){lightboxClose();let target=evt.target;target.className.includes("textMessage")?(clickOptionShow("text",evt),reactOptionShow(evt),navigator.vibrate(100)):target.className.includes("image-message")&&(clickOptionShow("image",evt),reactOptionShow(evt),navigator.vibrate(100))})),window.addEventListener("resize",()=>{appHeight(),updateScroll()}),document.addEventListener("contextmenu",event=>event.preventDefault()),appHeight();