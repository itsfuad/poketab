let socket=io(),e_users=[],e_avatars=[];const error=document.getElementById("error-callback"),url=window.location.href,error_code=url.substring(url.indexOf("?")+1);function makeid(length){let result="",characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",charactersLength=characters.length;for(let i=0;i<length;i++)result+=characters.charAt(Math.floor(Math.random()*charactersLength));return result}function check(){let allow=!1,name=$("#name").val();if(""===name)return $("#name-label").text("Name is required"),$("#name-label").css("color","red"),allow=!1,allow;allow=!0,e_users.forEach(user=>{name===user&&($("#name-label").text("Name already exists"),$("#name-label").css("color","red"),allow=!1)});let radios=document.getElementsByName("avatar"),checked=!1;for(var i=0;i<radios.length;i++)if(radios[i].checked){checked=!0;break}return checked||($("#name-label").text("Choose avatar"),$("#name-label").css("color","red")),allow&&checked&&($("#join").val("Creating..."),setTimeout(()=>{$("#join").val("Create")},2e3)),allow&&checked}console.log(error_code),error_code!==url&&(error.innerText="*Please fill up all requirements*"),$("#key").val(`${makeid(3)}-${makeid(3)}-${makeid(3)}-${makeid(3)}`),$("#key").on("click",()=>{let text=$("#key").val();console.log(text),navigator.clipboard.writeText(text),$("#key-label").css("color","limegreen"),$("#key-label").text("Key copied!"),setTimeout(()=>{$("#key-label").css("color","white"),$("#key-label").text("Tap to Copy")},2e3)}),$("#maxuser").on("input",()=>{$("#rangeValue").text($("#maxuser").val())}),$("#next").on("click",()=>{let key=$("#key").val();return""===key?($("#key-label").text("Key is required"),void $("#key-label").css("color","red")):15!==key.length?($("#key-label").text("Key is 12 digit"),void $("#key-label").css("color","red")):void socket.emit("createRequest",key)}),socket.on("createResponse",(keyExists,users,avatars)=>{keyExists?($("#key-label").text("Key already exists"),$("#key-label").css("color","red")):(e_users=users,e_avatars=avatars,e_avatars&&e_avatars.forEach(avatar=>{$(`label[for='${avatar}']`).hide()}),$(".form-1").hide(100),$(".howtouse").hide(100),$(".form-2").show(100))}),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw-poketab.js").then(reg=>console.log("Service Worker Registered")).catch(err=>console.log(`Service Worker: Error ${err}`))}),navigator.onLine?(console.log("online"),$(".offline").fadeOut(400)):(console.log("offline"),$(".offline").text("You are offline!"),$(".offline").css("background","orangered"),$(".offline").fadeIn(400)),window.addEventListener("offline",(function(e){console.log("offline"),$(".offline").text("You are offline!"),$(".offline").css("background","orangered"),$(".offline").fadeIn(400)})),window.addEventListener("online",(function(e){console.log("Back to online"),$(".offline").text("Back to online!"),$(".offline").css("background","limegreen"),setTimeout(()=>{$(".offline").fadeOut(400)},1500)})),document.addEventListener("contextmenu",event=>event.preventDefault());